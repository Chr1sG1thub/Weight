<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Weight Tracker</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.4/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
    #output { margin: 20px 0; font-size: 24px; font-weight: bold; }
    button { padding: 10px 20px; font-size: 18px; margin: 10px; }
    canvas { max-height: 400px; }
  </style>
</head>
<body>
  <h1>Weight Tracker</h1>
  <button id="startBtn">ðŸŽ¤ Start Voice Input</button>
  <div id="output">Say your weight in kilos.</div>
  <canvas id="chart"></canvas>

  <script>
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognition = SpeechRecognition ? new SpeechRecognition() : null;
    const output = document.getElementById('output');
    const startBtn = document.getElementById('startBtn');
    let chart;

    const numWords = {
      'zero': 0, 'one': 1, 'two': 2, 'three': 3, 'four': 4, 'five': 5, 'six': 6, 'seven': 7, 'eight': 8, 'nine': 9,
      'ten': 10, 'eleven': 11, 'twelve': 12, 'thirteen': 13, 'fourteen': 14, 'fifteen': 15, 'sixteen': 16,
      'seventeen': 17, 'eighteen': 18, 'nineteen': 19, 'twenty': 20, 'thirty': 30, 'forty': 40, 'fifty': 50,
      'sixty': 60, 'seventy': 70, 'eighty': 80, 'ninety': 90, 'hundred': 100, 'thousand': 1000
    };

    function wordsToNumber(text) {
      text = text.toLowerCase().replace(/ and /g, ' ').trim();
      let total = 0, current = 0;
      text.split(/\s+/).forEach(word => {
        if (word in numWords) {
          const val = numWords[word];
          if (val === 100) current *= 100;
          else if (val === 1000) current *= 1000;
          else {
            current += val;
            total += current;
            current = 0;
          }
        }
      });
      return total || parseFloat(text) || 0;
    }

    function loadData() {
      const data = localStorage.getItem('numbers');
      return data ? JSON.parse(data) : {};
    }

    function saveData(data) {
      localStorage.setItem('numbers', JSON.stringify(data));
      updateChart();
    }

    function updateChart() {
      const data = loadData();
      const mostRecentPair = data.reduce((best, cur) =>
  cur[0] > best[0] ? cur : best
);

const mostRecentValue = mostRecentPair[1];
      
      const labels = Object.keys(data).sort();
      const values = labels.map(date => data[date]);
      const ctx = document.getElementById('chart').getContext('2d');
      if (chart) chart.destroy();
      chart = new Chart(ctx, {
        type: 'line',
        data: { labels: labels.map(d => new Date(d)), datasets: [{ label: 'Number', data: values, borderColor: 'blue', fill: false }] },
        options: {
          scales: { x: { type: 'time', time: { unit: 'day' } } }
        }
      });
    }

    if (recognition) {
      recognition.continuous = false;
      recognition.interimResults = false;
      recognition.lang = 'en-US';
      recognition.onresult = (e) => {
        const transcript = e.results[0][0].transcript;
        const num = wordsToNumber(transcript);
        if (num > 0) {
          const today = new Date().toISOString().split('T')[0];
          const data = loadData();
          data[today] = num;
          saveData(data);
          output.textContent = `Stored ${num} for ${today}`;
        } else {
          output.textContent = `Invalid number from "${transcript}". Try again.`;
        }
      };
      recognition.onerror = () => { output.textContent = 'Voice error. Try again.'; };
      startBtn.onclick = () => recognition.start();
    } else {
      startBtn.disabled = true;
      output.textContent = 'SpeechRecognition not supported. Use text input or Chrome.';
    }

    updateChart();
  </script>
</body>
</html>
